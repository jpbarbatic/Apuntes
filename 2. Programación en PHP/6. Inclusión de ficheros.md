# Inclusi√≥n de ficheros
 La **inclusi√≥n de ficheros en PHP** es una t√©cnica fundamental en el desarrollo de aplicaciones web. Permite **reutilizar c√≥digo**, **modularizar aplicaciones** y **separar responsabilidades** (por ejemplo: cabeceras, men√∫s, conexiones a base de datos, pie de p√°gina, etc.).

---

**¬øPor qu√© incluir ficheros en PHP?**

En una aplicaci√≥n web real, **no queremos repetir c√≥digo** en cada p√°gina:
- La conexi√≥n a la base de datos.
- El men√∫ de navegaci√≥n.
- El pie de p√°gina.
- Funciones de validaci√≥n o utilidades.

La inclusi√≥n de ficheros resuelve esto: **escribes el c√≥digo una vez y lo reutilizas en m√∫ltiples p√°ginas**.

---

#Funciones para incluir ficheros en PHP

PHP ofrece **cuatro construcciones** para incluir archivos:

| Funci√≥n | Comportamiento si el archivo **no existe** |
|--------|------------------------------------------|
| `include` | Muestra un **warning** y contin√∫a la ejecuci√≥n |
| `require` | Muestra un **error fatal** y **detiene** la ejecuci√≥n |
| `include_once` | Igual que `include`, pero **solo incluye una vez** |
| `require_once` | Igual que `require`, pero **solo incluye una vez** |

> ‚úÖ **Regla en IAW**:  
> - Usa **`require_once`** para archivos esenciales (conexi√≥n a BBDD, funciones, configuraci√≥n).  
> - Usa **`include`** para partes opcionales (ej: bloques de contenido que pueden faltar).

---

## Sintaxis b√°sica

```php
include 'archivo.php';
require 'config/database.php';
include_once 'funciones/validacion.php';
require_once 'clases/Usuario.php';
```

> üí° Las rutas pueden ser:
> - **Relativas** al archivo actual: `'../config/db.php'`
> - **Absolutas**: `'/var/www/html/config/db.php'`
> - Usando constantes: `require_once RUTA_BASE . '/config/db.php';`

---

## Casos de uso comunes

1. **Conexi√≥n a base de datos (en un archivo aparte)**
```php
<!-- db.php -->
<?php
$host = 'localhost';
$db   = 'iaw_db';
$user = 'usuario';
$pass = 'secreto';
$charset = 'utf8mb4';

$dsn = "mysql:host=$host;dbname=$db;charset=$charset";
$pdo = new PDO($dsn, $user, $pass, [
    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION
]);
?>
```

```php
<!-- index.php -->
<?php
require_once 'db.php'; // Esencial: si falla, la app no debe seguir
// ... usar $pdo para consultar la BBDD
?>
```

---

2. **Plantillas: cabecera y pie de p√°gina**
```html
<!-- header.php -->
<!DOCTYPE html>
<html>
<head>
    <title>Mi App - IAW</title>
    <meta charset="UTF-8">
</head>
<body>
    <nav>
        <a href="index.php">Inicio</a>
        <a href="perfil.php">Perfil</a>
    </nav>
```

```html
<!-- footer.php -->
    <footer>
        <p>&copy; 2025 - Aplicaci√≥n IAW</p>
    </footer>
</body>
</html>
```

```php
<!-- perfil.php -->
<?php require_once 'header.php'; ?>

<h1>Mi perfil</h1>
<p>Bienvenido, usuario.</p>

<?php require_once 'footer.php'; ?>
```

> ‚úÖ Esto evita repetir HTML en cada p√°gina.

---

3. **Biblioteca de funciones**
```php
<!-- funciones.php -->
<?php
function sanitize_input($data) {
    return htmlspecialchars(trim($data));
}

function is_logged_in() {
    return isset($_SESSION['usuario']);
}
?>
```

```php
<!-- login.php -->
<?php
require_once 'funciones.php';
session_start();

if (is_logged_in()) {
    header('Location: perfil.php');
    exit;
}
// ... resto del login
?>
```

---

## Buenas pr√°cticas de seguridad

1. **Protege los archivos incluidos**
- **Nunca incluyas archivos basados en entrada de usuario sin validar**:
  ```php
  // ‚ùå MUY PELIGROSO
  include $_GET['pagina'] . '.php';
  ```

- **Usa listas blancas** si necesitas inclusi√≥n din√°mica:
  ```php
  // ‚úÖ Seguro
  $paginas_permitidas = ['inicio', 'perfil', 'contacto'];
  $pagina = $_GET['p'] ?? 'inicio';
  if (in_array($pagina, $paginas_permitidas)) {
      include "paginas/{$pagina}.php";
  } else {
      include "paginas/error.php";
  }
  ```

2. **Evita que se acceda directamente a archivos de inclusi√≥n**
A√±ade esta l√≠nea al principio de archivos que **solo deben incluirse**:
```php
<?php
// db.php
defined('ACCESO_PERMITIDO') or die('Acceso directo no permitido');
// ... resto del c√≥digo
?>
```

Y en los archivos principales:
```php
<?php
define('ACCESO_PERMITIDO', true);
require_once 'db.php';
?>
```

3. **Usa rutas absolutas o constantes**
Evita problemas de rutas relativas:
```php
// config.php
define('RUTA_BASE', __DIR__);

// index.php
require_once RUTA_BASE . '/config/db.php';
```

---

## `include_once` vs `include` (y `require_once` vs `require`)

| Situaci√≥n | Usa |
|----------|-----|
| Incluir una librer√≠a de funciones | `require_once` (evita redefinir funciones) |
| Incluir un fragmento de HTML (header, footer) | `include` o `require` (no hay riesgo de duplicaci√≥n) |
| Archivo esencial que no debe cargarse dos veces | `require_once` |

> üí° Si incluyes un archivo con funciones dos veces con `include`, PHP dar√° error:  
> `Cannot redeclare mi_funcion()`.

---

## Estructura t√≠pica de un proyecto 

```
mi-app/
‚îú‚îÄ‚îÄ index.php
‚îú‚îÄ‚îÄ perfil.php
‚îú‚îÄ‚îÄ login.php
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ db.php
‚îú‚îÄ‚îÄ includes/
‚îÇ   ‚îú‚îÄ‚îÄ header.php
‚îÇ   ‚îú‚îÄ‚îÄ footer.php
‚îÇ   ‚îî‚îÄ‚îÄ funciones.php
‚îî‚îÄ‚îÄ css/
    ‚îî‚îÄ‚îÄ estilo.css
```

> ‚úÖ Esta estructura es clara, segura y f√°cil de mantener.

**Resumen**

| Concepto | Recomendaci√≥n |
|--------|---------------|
| **Archivos esenciales** | Usa `require_once` |
| **Fragmentos HTML** | Usa `include` o `require` |
| **Rutas** | Usa constantes o rutas relativas cuidadosas |
| **Seguridad** | Nunca incluyas basado en `$_GET`/`$_POST` sin validar |
| **Estructura** | Separa en carpetas: `config/`, `includes/`, etc. |
