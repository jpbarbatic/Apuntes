# Cookies
El protocolo HTTP es un protocolo sin estado (stateless). Esto significa cada peticiÃ³n que se realiza es independiente de la anterior. Hemos visto que a travÃ©s de la URL se puede pasar informaciÃ³n, pero la URL tiene sus limitaciones, ademÃ¡s que no es una forma muy segura.

Las **cookies HTTP** fueron introducidas en **1994**, y su implementaciÃ³n en los navegadores y servidores se popularizÃ³ a partir de **1995**.

### ðŸ”¹ Origen histÃ³rico

- **Inventor**: **Lou Montulli**, un ingeniero de software que trabajaba en **Netscape Communications**.
- **MotivaciÃ³n**: Resolver el problema de la **falta de estado** en el protocolo HTTP, que es inherentemente **stateless** (sin estado).  
  Por ejemplo, un servidor no podÃ­a recordar si un usuario ya se habÃ­a autenticado o quÃ© productos habÃ­a puesto en un carrito de compras.

### ðŸ”¹ Primera implementaciÃ³n

- **1994**: Lou Montulli concibiÃ³ la idea de las cookies para una tienda en lÃ­nea de **MCI** que querÃ­a vender productos a travÃ©s de la web.
- **1995**: Netscape Navigator 0.95 (una de las primeras versiones del navegador Netscape) fue el **primer navegador en implementar cookies**.
- El mecanismo usaba un encabezado HTTP llamado `Set-Cookie` (del servidor al cliente) y `Cookie` (del cliente al servidor).

### ðŸ”¹ EstandarizaciÃ³n

Aunque nacieron como una propuesta de Netscape, las cookies pronto se convirtieron en un estÃ¡ndar de facto. Posteriormente fueron formalizadas por la **IETF** (Internet Engineering Task Force):

- **RFC 2109** (1997): Primera especificaciÃ³n oficial.
- **RFC 2965** (2000): RevisiÃ³n y mejora.
- **RFC 6265** (abril de **2011**): EspecificaciÃ³n actual y mÃ¡s ampliamente adoptada, titulada *"HTTP State Management Mechanism"*. Esta es la que define cÃ³mo funcionan las cookies en la web moderna.

---

### ðŸ”¹ Â¿Por quÃ© "cookie"?

El tÃ©rmino **"cookie"** proviene de la informÃ¡tica general, donde se usaba para referirse a un **"paquete de datos intercambiado entre programas"**. A su vez, esto viene de la expresiÃ³n **"magic cookie"**, usada en sistemas Unix para describir un token o dato que se pasa entre programas y que solo el emisor y receptor entienden.

---

### ðŸ”¹ Resumen cronolÃ³gico

| AÃ±o | Evento |
|-----|--------|
| **1994** | Lou Montulli inventa las cookies en Netscape. |
| **1995** | Primera implementaciÃ³n en **Netscape Navigator**. |
| **1996** | Microsoft adopta cookies en **Internet Explorer 3**. |
| **1997** | PublicaciÃ³n del **RFC 2109** (primera estandarizaciÃ³n). |
| **2011** | PublicaciÃ³n del **RFC 6265**, estÃ¡ndar actual. |

---

Hoy en dÃ­a, las cookies son fundamentales para la web moderna, aunque su uso estÃ¡ cada vez mÃ¡s regulado por normativas como el **RGPD** (en Europa) y leyes de privacidad que exigen consentimiento explÃ­cito del usuario.

Las cookies en PHP son una forma de almacenar pequeÃ±os fragmentos de informaciÃ³n en el navegador del usuario. Se utilizan comÃºnmente para recordar preferencias, mantener sesiones de usuario, rastrear comportamientos, entre otros fines. 


## ðŸª Â¿QuÃ© es una cookie?

Una **cookie** es un **pequeÃ±o archivo de texto** que un servidor web envÃ­a al navegador del usuario. El navegador lo almacena y, en futuras peticiones al mismo dominio, **lo devuelve automÃ¡ticamente al servidor**.

> âœ… **PropÃ³sito**: mantener estado en un protocolo (HTTP) que es **sin estado** (*stateless*).

---

## ðŸ” Flujo bÃ¡sico de una cookie

1. El servidor envÃ­a una cabecera HTTP:  
   `Set-Cookie: nombre=valor; expires=...; path=/; ...`
2. El navegador guarda la cookie.
3. En las siguientes peticiones a ese dominio, el navegador incluye:  
   `Cookie: nombre=valor`
4. PHP puede leerla con `$_COOKIE['nombre']`.


## ðŸ”¹ Â¿CÃ³mo se crean cookies en PHP?
```php
setcookie(nombre, valor, tiempo_expiraciÃ³n, ruta, dominio, seguro, sÃ³lo_http);
```
- nombre: nombre de la cookie.
- valor: valor que se almacena.
- tiempo_expiraciÃ³n: timestamp UNIX cuando expira (si es 0 o se omite, la cookie es de sesiÃ³n y se borra al cerrar el navegador).
- ruta: ruta en el servidor donde la cookie estarÃ¡ disponible (por ejemplo, '/' para todo el sitio).
- dominio: dominio al que se enviarÃ¡ la cookie (por ejemplo, 'ejemplo.com').
- seguro: si es true, solo se envÃ­a por HTTPS.
- sÃ³lo_http: si es true, la cookie no es accesible mediante JavaScript (protege contra XSS).
    

> 
>âš ï¸ **Importante**:
> - `setcookie()` **debe llamarse antes de enviar cualquier salida HTML** (ni siquiera un espacio o salto de lÃ­nea).  
> - Si no se especifica `tiempo_expiraciÃ³n`, la cookie es **de sesiÃ³n** (se borra al cerrar el navegador).

---

## ðŸ“¥ CÃ³mo leer una cookie en PHP

Las cookies estÃ¡n disponibles en la **variable superglobal `$_COOKIE`**.

```php
if (isset($_COOKIE["usuario"])) {
    echo "Hola, " . htmlspecialchars($_COOKIE["usuario"]);
} else {
    echo "No estÃ¡s identificado.";
}
```

> ðŸ”’ **Siempre usa `htmlspecialchars()`** al mostrar datos de cookies para evitar XSS.

---

## ðŸ§¹ CÃ³mo eliminar una cookie

Para eliminar una cookie, **se establece una fecha de expiraciÃ³n en el pasado**:

```php
// Eliminar la cookie "usuario"
setcookie("usuario", "", time() - 3600, "/");
```

> âœ… TambiÃ©n puedes usar `unset($_COOKIE['usuario'])`, pero **esto solo la elimina en el script actual**, no en el navegador. Lo correcto es usar `setcookie()` con tiempo pasado.

---

## âš™ï¸ ParÃ¡metros avanzados de `setcookie()`

| ParÃ¡metro | DescripciÃ³n | RecomendaciÃ³n en IAW |
|---------|-------------|----------------------|
| `nombre` | Nombre de la cookie | Usa nombres claros (`preferencia_tema`, `ultima_visita`) |
| `valor` | Valor a guardar | **Nunca almacenes datos sensibles** (contraseÃ±as, emails sin cifrar) |
| `expires` | Fecha de expiraciÃ³n (timestamp) | Siempre define un tiempo razonable |
| `path` | Ruta donde es vÃ¡lida | Usa `"/"` para que sea accesible en todo el sitio |
| `domain` | Dominio (ej: `.midominio.com`) | Solo si necesitas compartir entre subdominios |
| `secure` | Solo por HTTPS | âœ… **`true` en producciÃ³n** |
| `httponly` | No accesible desde JavaScript | âœ… **`true` siempre** (protege contra XSS) |

### Ejemplo seguro:
```php
setcookie(
    "tema", 
    "oscuro", 
    [
        'expires' => time() + 86400, // 1 dÃ­a
        'path' => '/',
        'secure' => true,      // solo HTTPS
        'httponly' => true,    // no accesible desde JS
        'samesite' => 'Strict' // protecciÃ³n contra CSRF
    ]
);
```

> ðŸ’¡ Desde PHP 7.3+, puedes usar un **array asociativo** para los parÃ¡metros (mÃ¡s legible).

---

## ðŸ”’ Seguridad: buenas prÃ¡cticas

1. **Nunca almacenes datos sensibles en cookies**  
   â†’ Usa **sesiones** (`$_SESSION`) para datos privados (IDs de usuario, roles, etc.).

2. **Usa `HttpOnly = true`**  
   â†’ Evita que JavaScript acceda a la cookie (protege contra ataques XSS).

3. **Usa `Secure = true` en producciÃ³n**  
   â†’ La cookie solo se envÃ­a por conexiones HTTPS.

4. **Valida y sanea siempre los valores de `$_COOKIE`**  
   â†’ Al igual que `$_GET` y `$_POST`, pueden ser manipulados por el usuario.

5. **No confÃ­es en las cookies para tomar decisiones crÃ­ticas**  
   â†’ Siempre verifica en el servidor (ej: si una cookie dice "es_admin", **no lo creas sin comprobar en la BBDD**).

---

