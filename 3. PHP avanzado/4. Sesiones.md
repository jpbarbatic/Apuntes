
# Sesiones

Las **sesiones en PHP** (y en la web en general) son un mecanismo fundamental para mantener el **estado** en aplicaciones web, a pesar de que el protocolo HTTP sea **stateless** (sin estado). A continuaci√≥n te explico cu√°ndo surgieron, c√≥mo funcionan y su relaci√≥n con las cookies.

---

## üîπ ¬øQu√© es una sesi√≥n?

Una **sesi√≥n** es un modo de almacenar datos **en el servidor** que est√°n asociados a un **usuario espec√≠fico** durante su interacci√≥n con una aplicaci√≥n web.  
A diferencia de las cookies (que almacenan datos en el navegador), las sesiones guardan la informaci√≥n del lado del servidor (en archivos, base de datos, memoria, etc.), y solo env√≠an al cliente un **identificador √∫nico** (normalmente mediante una cookie).

---

## üîπ ¬øCu√°ndo se introdujeron las sesiones en PHP?

- Las sesiones **no exist√≠an en las primeras versiones de PHP** (PHP/FI, PHP 2).
- Fueron introducidas oficialmente en **PHP 4**, lanzado en **mayo de 2000**.
- Aunque ya antes (en PHP 3, 1998) exist√≠an extensiones de terceros para gestionar sesiones, **PHP 4 integr√≥ nativamente el soporte para sesiones** mediante la extensi√≥n `mod_session`.

> ‚úÖ Desde entonces, `$_SESSION` se convirti√≥ en una **superglobal** est√°ndar en PHP.

---

## üîπ ¬øC√≥mo funcionan las sesiones en PHP?

1. **Inicio de sesi√≥n**:  
   Se llama a `session_start()`. Esto:
   - Genera un **ID de sesi√≥n √∫nico** (ej. `a3b8f9c2e1d4...`).
   - Env√≠a una **cookie al navegador** llamada `PHPSESSID` con ese ID (por defecto).
   - Crea un archivo (o registro) en el servidor asociado a ese ID.

2. **Almacenamiento de datos**:  
   Los datos se guardan en la superglobal `$_SESSION`:
   ```php
   $_SESSION['usuario'] = 'Ana';
   ```

3. **Peticiones posteriores**:  
   El navegador env√≠a la cookie `PHPSESSID` en cada solicitud ‚Üí PHP la usa para **recuperar los datos de sesi√≥n** del servidor.

4. **Fin de sesi√≥n**:  
   - Se puede destruir con `session_destroy()`.
   - O simplemente expira tras un tiempo de inactividad (por defecto, suele ser 24 minutos, configurable).

---

## üîπ Relaci√≥n entre sesiones y cookies

| Caracter√≠stica       | Sesi√≥n (`$_SESSION`)               | Cookie (`$_COOKIE`)                     |
|----------------------|------------------------------------|------------------------------------------|
| **Almacenamiento**   | En el **servidor**                 | En el **navegador del cliente**          |
| **Identificador**    | Se env√≠a v√≠a **cookie** (normalmente `PHPSESSID`) | Se almacena directamente en el navegador |
| **Seguridad**        | M√°s segura (datos no visibles al cliente) | Menos segura (el cliente puede ver/modificar) |
| **Vida √∫til**        | Hasta que se destruye o expira     | Puede ser de sesi√≥n o persistente        |

> ‚ö†Ô∏è Si el usuario **desactiva las cookies**, las sesiones por defecto **no funcionan**, a menos que se use **paso de ID por URL** (poco recomendado por seguridad).

---

## üîπ Configuraci√≥n com√∫n en PHP

En `php.ini` puedes ajustar:

```ini
session.cookie_secure = 1        ; Solo por HTTPS
session.cookie_httponly = 1      ; No accesible desde JavaScript
session.cookie_samesite = "Lax"  ; Protecci√≥n contra CSRF
session.gc_maxlifetime = 1440    ; Tiempo de vida en segundos (24 min)
```

Y en c√≥digo:

```php
// Configurar antes de session_start()
ini_set('session.cookie_secure', 1);
ini_set('session.cookie_httponly', 1);
ini_set('session.cookie_samesite', 'Lax');

session_start();
```

---

## üîπ Ejemplo b√°sico

```php
<?php
session_start();

if (!isset($_SESSION['visitas'])) {
    $_SESSION['visitas'] = 1;
} else {
    $_SESSION['visitas']++;
}

echo "Has visitado esta p√°gina " . $_SESSION['visitas'] . " veces.";
?>
```

---

¬°Excelente pregunta! En PHP, **borrar variables de sesi√≥n** y **cerrar (destruir) una sesi√≥n** son operaciones comunes en aplicaciones web, especialmente al implementar un **cierre de sesi√≥n (logout)**.

Vamos a verlo paso a paso:

---

## **Borrar variables individuales de la sesi√≥n**

Si solo quieres eliminar **una o algunas variables** de la sesi√≥n (pero mantener la sesi√≥n activa), usas `unset()`:

```php
<?php
session_start();

// Borrar una variable espec√≠fica
unset($_SESSION['usuario']);

// Borrar varias variables
unset($_SESSION['usuario'], $_SESSION['rol'], $_SESSION['ultimo_acceso']);
```

> ‚úÖ La sesi√≥n sigue activa; solo se eliminan los datos que ya no necesitas.

---

## **Borrar TODAS las variables de la sesi√≥n (pero mantener la sesi√≥n)**

Si quieres vaciar **todos los datos de la sesi√≥n**, pero **mantener el ID de sesi√≥n** (por ejemplo, para iniciar una nueva sesi√≥n sin cambiar el ID), usa:

```php
<?php
session_start();

// Vaciar todo el contenido de $_SESSION
$_SESSION = array();
```

> ‚ö†Ô∏è Esto **no destruye la sesi√≥n**, solo borra sus datos. El ID de sesi√≥n sigue siendo el mismo.

---

## **Cerrar/destruir completamente la sesi√≥n**

Para **cerrar la sesi√≥n de forma segura** (como en un bot√≥n de "Cerrar sesi√≥n"), debes hacer **tres cosas**:

1. **Borrar todas las variables de sesi√≥n**.
2. **Eliminar la cookie de sesi√≥n del navegador**.
3. **Destruir los datos de sesi√≥n en el servidor**.

### ‚úÖ C√≥digo recomendado para "logout":

```php
<?php
// Iniciar la sesi√≥n (neccesario para acceder a $_SESSION y al ID)
session_start();

// 1. Borrar todas las variables de sesi√≥n
$_SESSION = array();

// 2. Si se usa una cookie para el ID de sesi√≥n, eliminarla
if (ini_get("session.use_cookies")) {
    $params = session_get_cookie_params();
    setcookie(
        session_name(),
        '',
        time() - 42000, // Fecha en el pasado
        $params["path"],
        $params["domain"],
        $params["secure"],
        $params["httponly"]
    );
}

// 3. Destruir la sesi√≥n en el servidor
session_destroy();

// Opcional: redirigir al usuario
header("Location: /login.php");
exit;
```

### ¬øPor qu√© todo esto?

- `$_SESSION = array()` ‚Üí limpia los datos en memoria.
- `setcookie(... time() - 42000)` ‚Üí **elimina la cookie `PHPSESSID` del navegador**, para que no se reutilice.
- `session_destroy()` ‚Üí **borra el archivo de sesi√≥n en el servidor** (normalmente en `/tmp` o similar).

> üîí Esto evita que un atacante pueda reutilizar el ID de sesi√≥n (protecci√≥n contra *session fixation* y *session hijacking*).

---

## ¬øQu√© NO hacer?

‚ùå **Solo usar `session_destroy()` sin borrar la cookie**:
```php
session_start();
session_destroy(); // ¬°La cookie sigue en el navegador!
```
‚Üí El navegador seguir√° enviando el viejo `PHPSESSID`, y si alguien recrea una sesi√≥n con ese ID, ¬°podr√≠a suplantar al usuario!

‚ùå **No usar `session_start()` antes de destruir**:
‚Üí `session_destroy()` no funcionar√° si no hay una sesi√≥n activa.

---

## Resumen

| Acci√≥n | C√≥digo |
|-------|--------|
| Borrar una variable | `unset($_SESSION['clave']);` |
| Borrar todas las variables | `$_SESSION = [];` |
| Cerrar sesi√≥n (logout seguro) | Usa el bloque completo con `$_SESSION = []`, `setcookie()` y `session_destroy()` |

---
## Evoluci√≥n y alternativas modernas

Aunque las sesiones siguen siendo ampliamente usadas, hoy existen alternativas o complementos:

- **Tokens JWT** (JSON Web Tokens): almacenan datos en el cliente de forma firmada (√∫tiles en APIs).
- **Almacenamiento en base de datos**: para sesiones distribuidas (en entornos con m√∫ltiples servidores).
- **Redis / Memcached**: para sesiones r√°pidas y escalables.

Pero para aplicaciones web tradicionales (con formularios, login, carritos, etc.), **las sesiones siguen siendo la soluci√≥n m√°s simple y segura**.

## üÜö Cookies vs Sesiones

| Caracter√≠stica | **Cookies** | **Sesiones (`$_SESSION`)** |
|---------------|------------|----------------------------|
| **Almacenamiento** | En el **navegador del cliente** | En el **servidor** (ID en cookie) |
| **Tama√±o** | ~4 KB por cookie | Ilimitado (en el servidor) |
| **Seguridad** | Baja (visible/manipulable) | Alta (datos en servidor) |
| **Uso t√≠pico** | Preferencias, tracking, recordar login | Autenticaci√≥n, carritos, datos sensibles |
| **Duraci√≥n** | Puede ser persistente | Por defecto, hasta cerrar navegador |

> ‚úÖ **Regla**:  
> - Usa **cookies** para preferencias no cr√≠ticas (idioma, tema).  
> - Usa **sesiones** para todo lo relacionado con autenticaci√≥n o datos privados.


